(window.webpackJsonp=window.webpackJsonp||[]).push([[611],{247:function(n,a,s){"use strict";s.r(a);var e=s(2),r=Object(e.a)({},function(){var n=this,a=n.$createElement,s=n._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h1",{attrs:{id:"创建服务消费者（ribbon）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建服务消费者（ribbon）","aria-hidden":"true"}},[n._v("#")]),n._v(" 创建服务消费者（Ribbon）")]),n._v(" "),s("h2",{attrs:{id:"本节视频"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本节视频","aria-hidden":"true"}},[n._v("#")]),n._v(" 本节视频")]),n._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.bilibili.com/video/av27864612",target:"_blank",rel:"noopener noreferrer"}},[n._v("【视频】微服务框架-SpringCloud-创建服务消费者（Ribbon）"),s("OutboundLink")],1)])]),n._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[n._v("#")]),n._v(" 概述")]),n._v(" "),s("p",[n._v("在微服务架构中，业务都会被拆分成一个独立的服务，服务与服务的通讯是基于 http restful 的。Spring cloud 有两种服务调用方式，一种是 ribbon + restTemplate，另一种是 feign。在这一篇文章首先讲解下基于 ribbon + rest。")]),n._v(" "),s("h2",{attrs:{id:"ribbon-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ribbon-简介","aria-hidden":"true"}},[n._v("#")]),n._v(" Ribbon 简介")]),n._v(" "),s("p",[n._v("Ribbon 是一个负载均衡客户端，可以很好的控制 "),s("code",[n._v("http")]),n._v(" 和 "),s("code",[n._v("tcp")]),n._v(" 的一些行为。")]),n._v(" "),s("h2",{attrs:{id:"准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备工作","aria-hidden":"true"}},[n._v("#")]),n._v(" 准备工作")]),n._v(" "),s("ul",[s("li",[n._v("启动服务提供者（本教程案例工程为："),s("code",[n._v("hello-spring-cloud-service-admin")]),n._v("），端口号为："),s("code",[n._v("8762")])]),n._v(" "),s("li",[n._v("修改配置文件的端口号为："),s("code",[n._v("8763")]),n._v("，启动后在 Eureka 中会注册两个实例，这相当于一个小集群")])]),n._v(" "),s("p",[s("img",{attrs:{src:"/assets/Lusifer201805292246003.png",alt:""}})]),n._v(" "),s("h2",{attrs:{id:"创建服务消费者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建服务消费者","aria-hidden":"true"}},[n._v("#")]),n._v(" 创建服务消费者")]),n._v(" "),s("p",[n._v("创建一个工程名为 "),s("code",[n._v("hello-spring-cloud-web-admin-ribbon")]),n._v(" 的服务消费者项目，"),s("code",[n._v("pom.xml")]),n._v(" 配置如下：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.funtl</groupId>\n        <artifactId>hello-spring-cloud-dependencies</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n        <relativePath>../hello-spring-cloud-dependencies/pom.xml</relativePath>\n    </parent>\n\n    <artifactId>hello-spring-cloud-web-admin-ribbon</artifactId>\n    <packaging>jar</packaging>\n\n    <name>hello-spring-cloud-web-admin-ribbon</name>\n    <url>http://www.funtl.com</url>\n    <inceptionYear>2018-Now</inceptionYear>\n\n    <dependencies>\n        \x3c!-- Spring Boot Begin --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-tomcat</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-thymeleaf</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        \x3c!-- Spring Boot End --\x3e\n\n        \x3c!-- Spring Cloud Begin --\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\n        </dependency>\n        \x3c!-- Spring Cloud End --\x3e\n\n        \x3c!-- 解决 thymeleaf 模板引擎一定要执行严格的 html5 格式校验问题 --\x3e\n        <dependency>\n            <groupId>net.sourceforge.nekohtml</groupId>\n            <artifactId>nekohtml</artifactId>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <mainClass>com.funtl.hello.spring.cloud.web.admin.ribbon.WebAdminRibbonApplication</mainClass>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br")])]),s("p",[n._v("主要是增加了 Ribbon 的依赖")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\n</dependency>\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("h3",{attrs:{id:"application"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application","aria-hidden":"true"}},[n._v("#")]),n._v(" Application")]),n._v(" "),s("p",[n._v("通过 "),s("code",[n._v("@EnableDiscoveryClient")]),n._v(" 注解注册到服务中心")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("package com.funtl.hello.spring.cloud.web.admin.ribbon;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class WebAdminRibbonApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(WebAdminRibbonApplication.class, args);\n    }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br")])]),s("h3",{attrs:{id:"application-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application-yml","aria-hidden":"true"}},[n._v("#")]),n._v(" application.yml")]),n._v(" "),s("p",[n._v("设置程序端口号为："),s("code",[n._v("8764")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("spring:\n  application:\n    name: hello-spring-cloud-web-admin-ribbon\n  thymeleaf:\n    cache: false\n    mode: LEGACYHTML5\n    encoding: UTF-8\n    servlet:\n      content-type: text/html\n\nserver:\n  port: 8764\n\neureka:\n  client:\n    serviceUrl:\n      defaultZone: http://localhost:8761/eureka/\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br")])]),s("h3",{attrs:{id:"configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[n._v("#")]),n._v(" Configuration")]),n._v(" "),s("p",[n._v("配置注入 "),s("code",[n._v("RestTemplate")]),n._v(" 的 Bean，并通过 "),s("code",[n._v("@LoadBalanced")]),n._v(" 注解表明开启负载均衡功能")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("package com.funtl.hello.spring.cloud.web.admin.ribbon.config;\n\nimport org.springframework.cloud.client.loadbalancer.LoadBalanced;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.client.RestTemplate;\n\n@Configuration\npublic class RestTemplateConfiguration {\n\n    @Bean\n    @LoadBalanced\n    public RestTemplate restTemplate() {\n        return new RestTemplate();\n    }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br")])]),s("h3",{attrs:{id:"创建测试用的-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建测试用的-service","aria-hidden":"true"}},[n._v("#")]),n._v(" 创建测试用的 Service")]),n._v(" "),s("p",[n._v("在这里我们直接用的程序名替代了具体的 URL 地址，在 Ribbon 中它会根据服务名来选择具体的服务实例，根据服务实例在请求的时候会用具体的 URL 替换掉服务名，代码如下：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('package com.funtl.hello.spring.cloud.web.admin.ribbon.service;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.client.RestTemplate;\n\n@Service\npublic class AdminService {\n\n    @Autowired\n    private RestTemplate restTemplate;\n\n    public String sayHi(String message) {\n        return restTemplate.getForObject("http://HELLO-SPRING-CLOUD-SERVICE-ADMIN/hi?message=" + message, String.class);\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br")])]),s("h3",{attrs:{id:"创建测试用的-controller"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建测试用的-controller","aria-hidden":"true"}},[n._v("#")]),n._v(" 创建测试用的 Controller")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('package com.funtl.hello.spring.cloud.web.admin.ribbon.controller;\n\nimport com.funtl.hello.spring.cloud.web.admin.ribbon.service.AdminService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestMethod;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class AdminController {\n\n    @Autowired\n    private AdminService adminService;\n\n    @RequestMapping(value = "hi", method = RequestMethod.GET)\n    public String sayHi(@RequestParam String message) {\n        return adminService.sayHi(message);\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br")])]),s("h3",{attrs:{id:"测试访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试访问","aria-hidden":"true"}},[n._v("#")]),n._v(" 测试访问")]),n._v(" "),s("p",[n._v("在浏览器上多次访问 http://localhost:8764/hi?message=HelloRibbon")]),n._v(" "),s("p",[n._v("浏览器交替显示：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('Hi，your message is :"HelloRibbon" i am from port：8762\nHi，your message is :"HelloRibbon" i am from port：8763\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br")])]),s("p",[n._v("请求成功则表示我们已经成功实现了负载均衡功能来访问不同端口的实例")]),n._v(" "),s("h2",{attrs:{id:"此时的架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#此时的架构","aria-hidden":"true"}},[n._v("#")]),n._v(" 此时的架构")]),n._v(" "),s("p",[s("img",{attrs:{src:"/assets/Lusifer201805292246004.png",alt:""}})]),n._v(" "),s("ul",[s("li",[n._v("一个服务注册中心，Eureka Server，端口号为："),s("code",[n._v("8761")])]),n._v(" "),s("li",[s("code",[n._v("service-admin")]),n._v(" 工程运行了两个实例，端口号分别为："),s("code",[n._v("8762")]),n._v("，"),s("code",[n._v("8763")])]),n._v(" "),s("li",[s("code",[n._v("web-admin-ribbon")]),n._v(" 工程端口号为："),s("code",[n._v("8764")])]),n._v(" "),s("li",[s("code",[n._v("web-admin-ribbon")]),n._v(" 通过 "),s("code",[n._v("RestTemplate")]),n._v(" 调用 "),s("code",[n._v("service-admin")]),n._v(" 接口时因为启用了负载均衡功能故会轮流调用它的 "),s("code",[n._v("8762")]),n._v(" 和 "),s("code",[n._v("8763")]),n._v(" 端口")])]),n._v(" "),s("h2",{attrs:{id:"附"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附","aria-hidden":"true"}},[n._v("#")]),n._v(" 附")]),n._v(" "),s("h3",{attrs:{id:"在-idea-中配置一个工程启动多个实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在-idea-中配置一个工程启动多个实例","aria-hidden":"true"}},[n._v("#")]),n._v(" 在 IDEA 中配置一个工程启动多个实例")]),n._v(" "),s("h4",{attrs:{id:"步骤一"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤一","aria-hidden":"true"}},[n._v("#")]),n._v(" 步骤一")]),n._v(" "),s("p",[n._v("点击 "),s("code",[n._v("Run -> Edit Configurations...")])]),n._v(" "),s("p",[s("img",{attrs:{src:"/assets/Lusifer201805292246005.png",alt:""}})]),n._v(" "),s("h4",{attrs:{id:"步骤二"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤二","aria-hidden":"true"}},[n._v("#")]),n._v(" 步骤二")]),n._v(" "),s("p",[n._v("选择需要启动多实例的项目并去掉 "),s("code",[n._v("Single instance only")]),n._v(" 前面的勾")]),n._v(" "),s("p",[s("img",{attrs:{src:"/assets/Lusifer201805292246006.png",alt:""}})]),n._v(" "),s("h4",{attrs:{id:"步骤三"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤三","aria-hidden":"true"}},[n._v("#")]),n._v(" 步骤三")]),n._v(" "),s("p",[n._v("通过修改 "),s("code",[n._v("application.yml")]),n._v(" 配置文件的 "),s("code",[n._v("server.port")]),n._v(" 的端口，启动多个实例，需要多个端口，分别进行启动即可。")])])},[],!1,null,null,null);a.default=r.exports}}]);