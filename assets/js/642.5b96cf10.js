(window.webpackJsonp=window.webpackJsonp||[]).push([[642],{394:function(a,n,t){"use strict";t.r(n);var e=t(2),s=Object(e.a)({},function(){var a=this,n=a.$createElement,t=a._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"使用-spring-注解管理事务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-spring-注解管理事务","aria-hidden":"true"}},[a._v("#")]),a._v(" 使用 Spring 注解管理事务")]),a._v(" "),t("h2",{attrs:{id:"本节视频"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本节视频","aria-hidden":"true"}},[a._v("#")]),a._v(" 本节视频")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.bilibili.com/video/av25827802",target:"_blank",rel:"noopener noreferrer"}},[a._v("【视频】Spring 的事务管理-使用 Spring 注解管理事务"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),t("p",[a._v("通过 "),t("code",[a._v("@Transactional")]),a._v(" 注解方式，也可将事务织入到相应方法中。而使用注解方式，只需在配置文件中加入一个 "),t("code",[a._v("tx")]),a._v(" 标签，以告诉 Spring 使用注解来完成事务的织入。该标签只需指定一个属性，事务管理器。")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('\x3c!-- 开启事务注解驱动 --\x3e\n<tx:annotation-driven transaction-manager="transactionManager" />\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h2",{attrs:{id:"transactional-注解简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#transactional-注解简介","aria-hidden":"true"}},[a._v("#")]),a._v(" "),t("code",[a._v("@Transactional")]),a._v(" 注解简介")]),a._v(" "),t("p",[t("code",[a._v("@Transactional")]),a._v(" 的所有可选属性：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("propagation")]),a._v("：用于设置事务传播属性。该属性类型为 Propagation 枚举，默认值为 "),t("code",[a._v("Propagation.REQUIRED")]),a._v("。")]),a._v(" "),t("li",[t("code",[a._v("isolation")]),a._v("：用于设置事务的隔离级别。该属性类型为 Isolation 枚举 ，默认值为 "),t("code",[a._v("Isolation.DEFAULT")]),a._v("。")]),a._v(" "),t("li",[t("code",[a._v("readOnly")]),a._v("：用于设置该方法对数据库的操作是否是只读的。该属性为 boolean，默认值为 "),t("code",[a._v("false")]),a._v("。")]),a._v(" "),t("li",[t("code",[a._v("timeout")]),a._v("：用于设置本操作与数据库连接的超时时限。单位为秒，类型为 int，默认值为 -1，即没有时限。")]),a._v(" "),t("li",[t("code",[a._v("rollbackFor")]),a._v("：指定需要回滚的异常类。类型为 "),t("code",[a._v("Class[]")]),a._v("，默认值为空数组。当然，若只有一个异常类时，可以不使用数组。")]),a._v(" "),t("li",[t("code",[a._v("rollbackForClassName")]),a._v("：指定需要回滚的异常类类名。类型为 "),t("code",[a._v("String[]")]),a._v("，默认值为空数组。当然，若只有一个异常类时，可以不使用数组。")]),a._v(" "),t("li",[t("code",[a._v("noRollbackFor")]),a._v("：指定不需要回滚的异常类。类型为 "),t("code",[a._v("Class[]")]),a._v("，默认值为空数组。当然，若只有一个异常类时，可以不使用数组。")]),a._v(" "),t("li",[t("code",[a._v("noRollbackForClassName")]),a._v("： 指定不需要回滚的异常类类名。类型为 "),t("code",[a._v("String[]")]),a._v("，默认值为空数组。当然，若只有一个异常类时，可以不使用数组。")])]),a._v(" "),t("p",[a._v("需要注意的是，"),t("code",[a._v("@Transactional")]),a._v(" 若用在方法上，只能用于 "),t("code",[a._v("public")]),a._v(" 方法上。对于其他非 "),t("code",[a._v("public")]),a._v(" 方法，如果加上了注解 "),t("code",[a._v("@Transactional")]),a._v("，虽然 Spring 不会报错，但不会将指定事务织入到该方法中。因为 Spring 会忽略掉所有非 "),t("code",[a._v("public")]),a._v(" 方法上的 "),t("code",[a._v("@Transaction")]),a._v(" 注解。")]),a._v(" "),t("p",[a._v("若 "),t("code",[a._v("@Transaction")]),a._v(" 注解在类上，则表示该类上所有的方法均将在执行时织入事务。")]),a._v(" "),t("h2",{attrs:{id:"使用-transaction-注解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-transaction-注解","aria-hidden":"true"}},[a._v("#")]),a._v(" 使用 "),t("code",[a._v("@Transaction")]),a._v(" 注解")]),a._v(" "),t("p",[a._v("使用起来很简单，只需要在需要增加事务的业务类上增加 "),t("code",[a._v("@Transaction")]),a._v(" 注解即可，案例代码如下：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('package com.hello.spring.transaction.aspectsj.aop.service.impl;\n\nimport com.hello.spring.transaction.aspectsj.aop.dao.TbContentCategoryDao;\nimport com.hello.spring.transaction.aspectsj.aop.domain.TbContent;\nimport com.hello.spring.transaction.aspectsj.aop.domain.TbContentCategory;\nimport com.hello.spring.transaction.aspectsj.aop.service.TbContentCategoryService;\nimport com.hello.spring.transaction.aspectsj.aop.service.TbContentService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n@Transactional\n@Service(value = "tbContentCategoryService")\npublic class TbContentCategoryServiceImpl implements TbContentCategoryService {\n\n    @Autowired\n    private TbContentCategoryDao tbContentCategoryDao;\n\n    @Autowired\n    private TbContentService tbContentService;\n\n    public void save(TbContentCategory tbContentCategory, TbContent tbContent) {\n        tbContentCategoryDao.insert(tbContentCategory);\n        tbContentService.save(tbContent);\n    }\n}\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br")])])])},[],!1,null,null,null);n.default=s.exports}}]);